<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>SAP E2E Observability Demo</title>
    <script src="https://www.datadoghq-browser-agent.com/us1/v5/datadog-rum.js" type="text/javascript"></script>

<script>
    // 2. Inicialización Directa
    // Quitamos el window.datadogRum && para ver si explota aquí y nos dice por qué
    window.DD_RUM && window.DD_RUM.init({
        clientToken: 'clientToken',
        applicationId: 'appID',
        site: 'datadoghq.com',
        service: 'ui5-frontend',
        env: 'dev',
        version: '1.0.0',
        sessionSampleRate: 100,
        sessionReplaySampleRate: 100,
        trackUserInteractions: true,
        trackResources: true,
        trackLongTasks: true,
        defaultPrivacyLevel: 'allow',
        trackingConsent: 'granted',
        // ESTO NOS DARA LA PISTA FINAL
        allowedTracingUrls: [
        { 
            match: "https://tu-backend.hana.ondemand.com", 
            propagatorTypes: ["tracecontext"] // Formato W3C que entiende Java Spring Boot
        }
    ]
    });
</script>

    <script id="sap-ui-bootstrap"
        src="https://sdk.openui5.org/resources/sap-ui-core.js"
        data-sap-ui-theme="sap_fiori_3"
        data-sap-ui-libs="sap.m"
        data-sap-ui-async="true">
    </script>

    <script>
        sap.ui.getCore().attachInit(function() {
            sap.ui.require(["sap/m/Button", "sap/m/VBox", "sap/m/MessageToast", "sap/m/Title"], 
            function(Button, VBox, MessageToast, Title) {
                
                var oVBox = new VBox({
                    alignItems: "Center",
                    justifyContent: "Center",
                    items: [
                        new Title({ text: "SAP + Datadog: Observabilidad de Punta a Punta", titleStyle: "H2" }).addStyleClass("sapUiLargeMargin"),
                        
                        new Button({
                            text: "Cargar Pedidos OData (Success)",
                            width: "300px",
                            type: "Emphasized",
                            press: function() {
                                var sUrl = "https://sap-java-backend-courteous-cat-nm.cfapps.us10-001.hana.ondemand.com/sap/opu/odata/orders";
                                fetch(sUrl)
                                    .then(r => r.json())
                                    .then(data => {
                                        MessageToast.show("Éxito: " + data.d.results.length + " pedidos recibidos de SAP BTP.");
                                    })
                                    .catch(e => MessageToast.show("Error de conexión con el Backend"));
                            }
                        }).addStyleClass("sapUiSmallMargin"),

                        new Button({
                            text: "Simular Error en Proceso SAP",
                            width: "300px",
                            type: "Reject",
                            press: function() {
                                var sUrl = "https://sap-java-backend-courteous-cat-nm.cfapps.us10-001.hana.ondemand.com/sap/opu/odata/error";
                                fetch(sUrl).then(r => {
                                    if(!r.ok) MessageToast.show("Error 500 enviado a Datadog");
                                });
                            }
                        }).addStyleClass("sapUiSmallMargin")
                    ]
                }).placeAt("content");
            });
        });
    </script>
</head>
<body class="sapUiBody" id="content"></body>
</html>
